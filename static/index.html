<!DOCTYPE html>
<html>
<head>
    <title>Chronic Reader Client</title>
    <link rel="manifest" href="manifest.json">
    <script src="/serviceworkerinstall.js"></script>
    <script>
        function getBookItem(book) {
            let item = document.createElement("li")
            let itemLink = document.createElement("a")
            itemLink.href = "/read.html?book=" + book.id
            let image = document.createElement("img")
            image.src = book.cover
            itemLink.appendChild(image)
            let title = document.createElement("span")
            title.innerHTML = book.title
            itemLink.appendChild(title)
            item.appendChild(itemLink)
            return item
        }
        window.onload = function() {
            fetch("/books")
            .then(response => {
                console.log(response)
                return response.json()
            })
            .then((books) => {
                console.log(books)
                let booklist = document.getElementById("booklist")
                booklist.innerHTML = ""
                for (let i = 0; i < books.length; i++) {
                    let item = getBookItem(books[i])
                    booklist.appendChild(item)
                }
            })
            /*fetch("search")
            .then(response => {
                console.log(response)
                return response.json()
            })
            .then(searchResult => {
                console.log(searchResult)
                let searchList = document.getElementById("searchList")
                searchList.innerHTML = ""
                for (let i = 0; i < searchResult.length; i++) {
                    let item = getBookItem(searchResult[i])
                    searchList.appendChild(item)
                }
            })*/
        }
    </script>
    <style>
        img {
            max-width: 10vw;
        }
    </style>
</head>
<body>
    <h1>Chronic Reader Client</h1>
    <ul id="booklist"></ul>
    <form action="upload" enctype="multipart/form-data" method="post">
        <label for="myFile">Upload Your File</label>
        <input id="myFile" accept=".epub,.cbz,.cbr" name="filename" type="file" />
        <button name="submit" type="submit">Upload File</button>
    </form>
    <form action="login" method="post">
        <label for="server">Server</label><input name="server" type="text" />
        <label for="username">Username</label><input name="username" type="text" />
        <label for="password"></label><input name="password" type="password" />
        <button name="submit" type="submit">Login</button>
    </form>
    <ul id="searchList"></ul>
</body>
</html>